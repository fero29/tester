<!DOCTYPE html>
<html lang="sk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Tester - Inteligentné testovanie</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
    <div class="container">
        <div class="app-header">
            <h1 onclick="backToList()" style="cursor: pointer;" title="Späť na hlavnú stránku">AI Tester</h1>
            <span class="version-badge" onclick="showVersionInfo()" style="cursor: pointer;" title="Kliknite pre info">v1.3.26</span>
        </div>

        <!-- Zoznam testov -->
        <div class="section">
            <div class="test-header-controls">
                <h2>Dostupné testy</h2>
                <div>
                    <button onclick="showHelpPage()" class="btn-info btn-small">📖 Návod</button>
                    <button onclick="showImportPage()" class="btn-import btn-small">📁 Import testov</button>
                    <button onclick="showAIImportPage()" class="btn-ai-import btn-small">🤖 AI Import</button>
                    <button onclick="startMultipleTests()" class="btn-multi" id="startMultiBtn" style="display: none;">
                        Spustiť vybrané testy
                    </button>
                    <button onclick="clearStatistics()" class="btn-danger btn-small">Vymazať štatistiky</button>
                </div>
            </div>
            <div id="testList">
                <div id="loadingIndicator" style="text-align: center; padding: 40px; color: #666;">
                    <div style="font-size: 1.2em; margin-bottom: 10px;">⏳ Načítavam testy...</div>
                </div>
            </div>
        </div>

        <!-- Verzia Info -->
        <div id="versionPage" style="display: none;">
            <h2>ℹ️ AI Tester v1.3.26</h2>

            <div class="help-section">
                <h3>🎯 Hlavné funkcie</h3>
                <ul>
                    <li><strong>🤖 AI Import otázok z fotky</strong> - Odfotiť otázky a AI ich automaticky rozpozná</li>
                    <li><strong>🔬 Pokročilé predspracovanie</strong> - OpenCV algoritmy pre čiernobiele s vysokým kontrastom</li>
                    <li><strong>📸 Výrezy otázok</strong> - Každá otázka má svoj výrez z fotky pre kontrolu</li>
                    <li><strong>✏️ Editor testov</strong> - Úprava existujúcich testov priamo v aplikácii</li>
                    <li><strong>✅ Viacero správnych odpovedí</strong> - Podpora otázok s viacerými správnymi odpoveďami</li>
                    <li><strong>📊 Štatistiky</strong> - Sledovanie výsledkov, priemernej úspešnosti</li>
                    <li><strong>⏱️ Časový limit</strong> - 20/30/60 minút alebo bez limitu</li>
                    <li><strong>🎲 Mixovanie otázok</strong> - Náhodné poradie pre lepšiu prax</li>
                    <li><strong>📚 Režim učenia</strong> - Prezeranie všetkých otázok so správnymi odpoveďami</li>
                    <li><strong>🔄 Zlučovanie testov</strong> - Možnosť absolvovať viac testov naraz</li>
                </ul>
            </div>

            <div class="help-section">
                <h3>🆕 Novinky v1.3.26</h3>
                <ul>
                    <li>🎉 <strong>Finálny výsledok po retry</strong> - Po úspešnom opakovaní sa zobrazí a uloží 100% výsledok</li>
                    <li>📊 <strong>Správne štatistiky</strong> - Finálna štatistika zobrazuje pôvodný počet otázok (napr. 20/20, nie 5/5)</li>
                </ul>
            </div>

            <div class="help-section">
                <h3>Novinky v1.3.25</h3>
                <ul>
                    <li>📊 <strong>Štatistiky v režime "Opakovať nesprávne"</strong> - Ukladá sa výsledok po prvom odovzdaní</li>
                    <li>📈 <strong>Sledovanie pokroku</strong> - Vidíte svoj prvý výsledok aj keď test opakujete</li>
                </ul>
            </div>

            <div class="help-section">
                <h3>Novinky v1.3.24</h3>
                <ul>
                    <li>📖 <strong>Zjednodušený návod</strong> - Najprv ako používať, potom ako vytvárať</li>
                    <li>⏳ <strong>Loading indikátor</strong> - "Načítavam testy..." pri štarte</li>
                    <li>🔒 <strong>Skryté tlačidlá upraviť/vymazať</strong> - Jednoduchšie a bezpečnejšie rozhranie</li>
                    <li>💾 <strong>Čistá záloha testov</strong> - Bez cropImage, z 21MB na 152KB</li>
                </ul>
            </div>

            <div class="help-section">
                <h3>Novinky v1.3.23</h3>
                <ul>
                    <li>✅ <strong>Režim "Opakovať nesprávne" zobrazuje feedback</strong> - Po každej otázke sa ukáže či je správne/nesprávne</li>
                </ul>
            </div>

            <div class="help-section">
                <h3>Novinky v1.3.22</h3>
                <ul>
                    <li>🔄 <strong>Nový režim: Opakovať nesprávne otázky</strong> - Nesprávne odpovede sa automaticky opakujú až kým neodpoviete správne</li>
                    <li>❌ <strong>Odstránené "Nezobrazovať odpovede"</strong> - Zbytočná možnosť bola vymazaná</li>
                    <li>✅ <strong>Predvolené zobrazenie po každej otázke</strong> - Lepšia predvolená voľba pre učenie</li>
                </ul>
            </div>

            <div class="help-section">
                <h3>Novinky v1.3.21</h3>
                <ul>
                    <li>📚 <strong>Zoznam testov pri importe</strong> - Zobrazuje všetky testy v priečinku s názvom a počtom otázok</li>
                    <li>👀 <strong>Prehľad existujúcich testov</strong> - Pri otvorení "📁 Import testov" vidíte čo už máte</li>
                </ul>
            </div>

            <div class="help-section">
                <h3>Novinky v1.3.20</h3>
                <ul>
                    <li>💾 <strong>Oprava importu testov</strong> - Nahrané testy sa teraz ukladajú do priečinka testy/ a zostanú tam trvale</li>
                    <li>📁 <strong>Trvalé uloženie</strong> - Import cez "📁 Import testov" teraz funguje správne</li>
                </ul>
            </div>

            <div class="help-section">
                <h3>Novinky v1.3.19</h3>
                <ul>
                    <li>✏️ <strong>Manuálne zadávanie názvu</strong> - Pri AI importe používateľ sám zadáva názov a popis testu</li>
                    <li>🚫 <strong>Odstránené automatické návrhy</strong> - Už sa nezobrazujú navrhované názvy od AI</li>
                    <li>🐛 <strong>Oprava chyby</strong> - Vyriešený problém "Cannot set properties of null" pri AI importe</li>
                </ul>
            </div>

            <div class="help-section">
                <h3>Novinky v1.3.18</h3>
                <ul>
                    <li>⚡ <strong>Automatické načítanie testov</strong> - Testy sa načítajú automaticky pri otvorení aplikácie</li>
                    <li>❌ <strong>Odstránené tlačidlo "Automaticky načítať"</strong> - Už nie je potrebné</li>
                    <li>💾 <strong>Autosave pri úprave testov</strong> - Zmeny sa automaticky ukladajú po 1 sekunde od poslednej úpravy</li>
                    <li>📁 <strong>Automatické vytvorenie priečinka testy/</strong> - Vytvorí sa ak neexistuje</li>
                </ul>
            </div>

            <div class="help-section">
                <h3>Novinky v1.3.17</h3>
                <ul>
                    <li>📝 <strong>Automatické premenovanie súboru</strong> - Pri zmene názvu testu sa automaticky premenuje aj súbor</li>
                    <li>🛡️ <strong>Testy nie sú v git</strong> - Priečinok testy/ je pridaný do .gitignore, vaše testy sa neprepíšu pri update</li>
                    <li>💾 <strong>Lokálne ukladanie</strong> - Všetky zmeny testov sa ukladajú len lokálne</li>
                </ul>
            </div>

            <div class="help-section">
                <h3>Novinky v1.3.16</h3>
                <ul>
                    <li>✅ <strong>Opravené pridávanie do existujúceho testu</strong> - Otázky sa teraz správne pridajú do vybraného testu</li>
                    <li>🔧 <strong>Zjednodušená logika</strong> - Pri výbere "Pridať do existujúceho" sa otázky vždy pridajú bez kontroly názvu</li>
                    <li>📊 <strong>Lepšie logovanie</strong> - Server loguje koľko otázok bolo pridaných</li>
                </ul>
            </div>

            <div class="help-section">
                <h3>Novinky v1.3.14</h3>
                <ul>
                    <li>🎯 <strong>Opravený layout pri otočených obrázkoch</strong> - Tlačidlo rotácie je teraz vždy dostupné aj pri otočenom obrázku na výšku</li>
                    <li>📐 <strong>Rezervovaný priestor pre náhľady</strong> - Minimálna výška 200px predchádza prekrývaniu tlačidiel</li>
                    <li>✨ <strong>Vycentrované obrázky</strong> - Obrázky sú automaticky centrované v kontajneri</li>
                </ul>
            </div>

            <div class="help-section">
                <h3>Novinky v1.3.13</h3>
                <ul>
                    <li>🔄 <strong>Zjednodušená rotácia</strong> - Iba 1 tlačidlo (↷) namiesto 3, stlačte 3x pre rotáciu o 270°</li>
                    <li>📊 <strong>Progress pri spájaní fotiek</strong> - Zobrazuje sa "Pripravujem fotku 1/5...", "2/5..." pri viacerých fotkách</li>
                    <li>⚡ <strong>Lepšia spätná väzba</strong> - Vidíte presný priebeh spracovania každej fotky</li>
                </ul>
            </div>

            <div class="help-section">
                <h3>Novinky v1.3.12</h3>
                <ul>
                    <li>🎯 <strong>Prispôsobenie pre OpenAI API limity</strong> - Spojené fotky sa automaticky zmenia na max 2048px (dlhší rozmer)</li>
                    <li>⚡ <strong>Opravená chyba pri viacerých fotkách</strong> - JSON parse error pri 5+ fotkách je vyriešený</li>
                    <li>✅ <strong>Jednotlivé fotky zostávajú v plnej kvalite</strong> - Resize sa aplikuje len na spojené viacero fotiek</li>
                </ul>
            </div>

            <div class="help-section">
                <h3>Novinky v1.3.9</h3>
                <ul>
                    <li>🖼️ <strong>Bez zmeny veľkosti fotiek</strong> - Fotky sa už nezmenšujú, zachováva sa pôvodná kvalita a rozlíšenie</li>
                    <li>✨ <strong>Vysoká kvalita JPEG (92%)</strong> - Len optimalizácia bez straty detailov</li>
                    <li>📏 <strong>Správne rozmery pri spojení</strong> - Opravený výpočet rozmerov pri spojení viacerých fotiek</li>
                    <li>🎯 <strong>Lepšie AI rozpoznávanie</strong> - Vďaka plnému rozlíšeniu AI vidí všetky detaily</li>
                </ul>
            </div>

            <div class="help-section">
                <h3>Novinky v1.3.8</h3>
                <ul>
                    <li>📸 <strong>Spojenie viacerých fotiek do jednej</strong> - Pri nahraní viacerých fotiek sa automaticky spoja vertikálne do jedného obrázka</li>
                    <li>⚡ <strong>Jeden AI request namiesto viacerých</strong> - Všetky otázky sa spracujú naraz, bez potreby posielať viac requestov</li>
                    <li>🔄 <strong>Rotácia sa aplikuje pred spojením</strong> - Každá fotka sa najprv otočí podľa nastavenia a potom sa spoja</li>
                    <li>✅ <strong>Opravený bug</strong> - Všetky otázky z viacerých fotiek sa teraz správne importujú</li>
                </ul>
            </div>

            <div class="help-section">
                <h3>Novinky v1.3.7</h3>
                <ul>
                    <li>🗜️ <strong>Automatická kompresia obrázkov</strong> - Fotky sa automaticky zmenšujú a komprimujú pred uploadom (max 2000px, kvalita 80%)</li>
                    <li>⚡ <strong>Rýchlejší upload</strong> - Menšie súbory = rýchlejšie nahrávanie aj s pomalším internetom</li>
                    <li>💾 <strong>Úspora bandwidth</strong> - Komprimované obrázky majú podstatne menšiu veľkosť (často 5-10x menšie)</li>
                    <li>📊 <strong>Zvýšený upload limit</strong> - Nginx teraz podporuje súbory do 100MB</li>
                </ul>
            </div>

            <div class="help-section">
                <h3>Novinky v1.3.6</h3>
                <ul>
                    <li>🎨 <strong>Zjednodušené AI import zobrazenie</strong> - Odstránené pôvodné fotky a výrezy otázok pre čistejšie rozhranie</li>
                    <li>📊 <strong>Jedno scrollovateľné okno pre predspracovanú fotku</strong> - Lepší prehľad toho, čo AI videlo (max. výška 500px)</li>
                    <li>✨ <strong>Prehľadnejšia editácia otázok</strong> - Otázky bez rušivých výrezov, iba čistý text a odpovede</li>
                </ul>
            </div>

            <div class="help-section">
                <h3>Novinky v1.3.5</h3>
                <ul>
                    <li>❌ <strong>Tlačidlo "Zrušiť" vo všetkých krokoch AI importu</strong> - Kedykoľvek môžete zrušiť import (pri nahrávaní, počas spracovania, pri editácii aj ukladaní)</li>
                    <li>🚪 <strong>Jednoduchý návrat</strong> - Rýchle zrušenie importu a návrat na začiatok v každom kroku procesu</li>
                </ul>
            </div>

            <div class="help-section">
                <h3>Novinky v1.3.4</h3>
                <ul>
                    <li>☑ <strong>Vždy možnosť výberu viacerých odpovedí</strong> - Všetky odpovede fungujú ako checkboxy, dá sa označiť aj viac odpovedí</li>
                    <li>🎯 <strong>Flexibilné testovanie</strong> - Aj pri otázkach s 1 správnou odpoveďou môžete vyskúšať označiť viac možností</li>
                </ul>
            </div>

            <div class="help-section">
                <h3>Novinky v1.3.3</h3>
                <ul>
                    <li>🎨 <strong>Čistejšie používateľské rozhranie</strong> - Odstránené rušivé varovania pri otázkach s viacerými správnymi odpoveďami</li>
                </ul>
            </div>

            <div class="help-section">
                <h3>Novinky v1.3.2</h3>
                <ul>
                    <li>❌ <strong>Tlačidlo "Zrušiť import"</strong> - Možnosť zrušiť AI import a vrátiť sa na začiatok</li>
                </ul>
            </div>

            <div class="help-section">
                <h3>Novinky v1.3.1</h3>
                <ul>
                    <li>🐛 <strong>Oprava localStorage quota exceeded</strong> - Neukladajú sa base64 obrázky, len text otázok</li>
                </ul>
            </div>

            <div class="help-section">
                <h3>Novinky v1.3.0</h3>
                <ul>
                    <li>🔄 <strong>Manuálna rotácia fotiek</strong> - Tlačidlá na otáčanie každej fotky (↶ 90° vľavo, ↷ 90° vpravo, 180°)</li>
                    <li>📐 <strong>Perspektívna korekcia (deskew)</strong> - Automaticky opraví fotky fotené z uhla pomocou detekcie hrán</li>
                    <li>🧹 <strong>Vylepšené odstránenie šumu</strong> - Silnejší denoising (h=15) + bilateral filter pre čistejší výsledok</li>
                    <li>💾 <strong>Perzistencia AI importu</strong> - Stav sa ukladá do localStorage, môžete sa prekliknúť a vrátiť späť</li>
                </ul>
            </div>

            <div class="help-section">
                <h3>Novinky v1.2.0</h3>
                <ul>
                    <li>🎯 <strong>Inteligentné výrezy otázok</strong> - AI teraz detekuje presnú pozíciu každej otázky na fotke</li>
                    <li>📐 <strong>Riešenie problému s logom/obrázkami</strong> - Výrezy správne sedia aj keď je na fotke logo, obrázok alebo prázdne miesto</li>
                    <li>📏 <strong>Väčšie zobrazenie výrezov</strong> - Zväčšené výrezy pre lepšiu čitateľnosť (min-height: 200px)</li>
                    <li>🔧 <strong>Fallback mechanizmus</strong> - Ak AI neposkytne pozície, použije sa rovnomerné delenie</li>
                </ul>
            </div>

            <div class="help-section">
                <h3>Novinky v1.1.0</h3>
                <ul>
                    <li>🔬 <strong>Pokročilé predspracovanie OpenCV</strong> - CLAHE, denoising, adaptívny threshold, morfologické operácie</li>
                    <li>📸 <strong>Výrezy otázok</strong> - Nad každou otázkou sa zobrazí výrez z predspracovanej fotky</li>
                    <li>👁️ <strong>Porovnanie obrázkov</strong> - Vedľa seba: predspracovaný vs pôvodný</li>
                    <li>📷 <strong>Viacero fotiek naraz</strong> - Import viacerých obrázkov súčasne</li>
                    <li>🔄 <strong>Automatické otočenie</strong> - EXIF orientácia (fotky z mobilu)</li>
                    <li>🎯 <strong>High detail API</strong> - Lepšia presnosť rozpoznávania s GPT-4o</li>
                    <li>🏠 <strong>Klikateľné logo</strong> - Návrat na hlavnú stránku</li>
                </ul>
            </div>

            <div class="help-section">
                <h3>🤖 AI Import - Ako to funguje?</h3>
                <ol>
                    <li>Odfotiť alebo nahrať fotku s otázkami</li>
                    <li>Obrázok sa automaticky predspracuje (ostrosť, kontrast, jas)</li>
                    <li>AI (GPT-4o) analyzuje obrázok a rozpozná:
                        <ul>
                            <li>Text otázok a odpovedí</li>
                            <li>Zakrúžkované odpovede</li>
                            <li>Podčiarknutý, tučný alebo zvýraznený text</li>
                            <li>Checkmarky a hviezdičky</li>
                        </ul>
                    </li>
                    <li>Skontrolujete a upravíte výsledok</li>
                    <li>Uložíte ako nový test alebo pridáte k existujúcemu</li>
                </ol>
            </div>

            <div class="help-section">
                <h3>💡 Tipy na lepšie výsledky</h3>
                <ul>
                    <li>Urobte ostrú fotografiu s dobrým osvetlením</li>
                    <li>Správne odpovede jasne zakrúžkujte alebo podčiarknite</li>
                    <li>Text by mal byť čitateľný a nezmazaný</li>
                    <li>Vyhnite sa tieňom a odleskom</li>
                </ul>
            </div>

            <button onclick="backToList()" class="btn-secondary">← Späť na zoznam testov</button>
        </div>

        <!-- Návod -->
        <div id="helpPage" style="display: none;">
            <h2>📖 Návod na použitie</h2>

            <div class="help-section">
                <h3>🎯 Ako používať testy</h3>
                <ol>
                    <li><strong>Vyberte test</strong> zo zoznamu - kliknite na názov testu</li>
                    <li><strong>Nastavte parametre:</strong>
                        <ul>
                            <li><strong>Časový limit:</strong> 20/30/60 minút alebo bez limitu</li>
                            <li><strong>Rozsah otázok:</strong> Napr. 1-50 (môžete vybrať len časť testu)</li>
                            <li><strong>Poradie:</strong> Po poradí alebo zamixované (náhodné)</li>
                            <li><strong>Zobrazenie odpovedí:</strong>
                                <ul>
                                    <li><em>Po každej otázke</em> - ihneď uvidíte či je správne ✅</li>
                                    <li><em>Na konci testu</em> - všetky odpovede naraz</li>
                                    <li><em>Opakovať nesprávne</em> - nesprávne sa opakujú až kým neodpoviete správne</li>
                                </ul>
                            </li>
                        </ul>
                    </li>
                    <li><strong>Kliknite:</strong>
                        <ul>
                            <li><strong>Spustiť test</strong> - klasický test s časomerom a hodnotením</li>
                            <li><strong>Režim učenia</strong> - prezeranie všetkých otázok so správnymi odpoveďami</li>
                        </ul>
                    </li>
                    <li><strong>Absolvujte test</strong> a pozrite si výsledky so štatistikami</li>
                </ol>
            </div>

            <div class="help-section">
                <h3>⭐ Užitočné funkcie</h3>
                <ul>
                    <li><strong>Viacero testov naraz:</strong> Zaškrtnite checkboxy pri viacerých testoch → kliknite "Spustiť vybrané testy" → zlúčia sa do jedného</li>
                    <li><strong>Štatistiky:</strong> Pod každým testom vidíte počet absolvovaní, posledný výsledok a priemer</li>
                    <li><strong>Režim učenia:</strong> Prečítajte si všetky otázky so správnymi odpoveďami bez časového tlaku</li>
                </ul>
            </div>

            <div class="help-section">
                <h3>🤖 Vytvorenie testov cez AI</h3>
                <ol>
                    <li><strong>Kliknite na "🤖 AI Import"</strong></li>
                    <li><strong>Nahrajte fotografiu</strong> otázok (môžete aj viac naraz)</li>
                    <li><strong>Voliteľne zapnite</strong> "🔬 Pokročilé predspracovanie" pre lepšie rozpoznávanie</li>
                    <li><strong>Kliknite "✨ Spracovať s AI"</strong> - AI automaticky rozpozná otázky a odpovede</li>
                    <li><strong>Skontrolujte otázky</strong> - môžete upraviť, pridať alebo zmazať</li>
                    <li><strong>Zadajte názov testu</strong> a popis</li>
                    <li><strong>Uložte test</strong> - test sa uloží do priečinka <code>testy/</code></li>
                </ol>
                <p><strong>💡 Tip:</strong> Pre najlepšie výsledky robte ostré fotky s dobrým osvetlením!</p>
            </div>

            <div class="help-section">
                <h3>📁 Načítanie existujúcich testov</h3>
                <ul>
                    <li><strong>Automaticky:</strong> Vložte JSON súbory do priečinka <code>testy/</code> a obnovte stránku</li>
                    <li><strong>Manuálne nahratie:</strong> Kliknite "📁 Import testov" → vyberte JSON súbor → "📤 Nahrať súbor"</li>
                </ul>
            </div>

            <div class="help-section">
                <h3>📝 Formát JSON súboru (pre programátorov)</h3>
                <p>Ak chcete vytvoriť test manuálne v JSON formáte:</p>
                <pre><code>[{
  "title": "Názov testu",
  "description": "Popis",
  "questions": [{
    "question": "Text otázky?",
    "answers": ["A", "B", "C"],
    "correct": 0
  }]
}]</code></pre>
                <p><strong>Pravidlá:</strong> <code>correct</code> = číslo (jedna správna) alebo <code>[0, 2]</code> (viac správnych). Index od 0.</p>
            </div>

            <button onclick="backToList()" class="btn-secondary">← Späť na zoznam testov</button>
        </div>

        <!-- Import testov -->
        <div id="importPage" style="display: none;">
            <h2>Import testov</h2>

            <div class="import-section">
                <h3>Načítanie z priečinka <code>testy/</code></h3>
                <p class="import-info">Testy sa automaticky načítajú z priečinka <code>testy/</code></p>
                <p class="import-info">✓ Jednoducho vložte JSON súbory do priečinka <code>testy/</code> a obnovte stránku</p>

                <div id="existingTestsList" style="margin-top: 20px;">
                    <h4 style="margin-bottom: 10px; color: #2196F3;">📚 Testy v priečinku:</h4>
                    <div id="existingTestsContent" style="max-height: 300px; overflow-y: auto; border: 1px solid #ddd; border-radius: 8px; padding: 10px; background: #f9f9f9;">
                        <p style="color: #666; text-align: center;">Načítavam...</p>
                    </div>
                </div>

                <button onclick="showExample()" class="btn-info" style="margin-top: 15px;">📖 Zobraziť príklad formátu</button>
            </div>

            <div class="import-divider">ALEBO</div>

            <div class="import-section">
                <h3>Manuálne nahranie súboru</h3>
                <p class="import-info">Vyberte JSON súbor z vášho počítača</p>
                <input type="file" id="fileInput" accept=".json">
                <button onclick="importTests()">📤 Nahrať súbor</button>
            </div>

            <div class="import-section danger-section">
                <h3>Vymazať testy</h3>
                <button onclick="clearTests()" class="btn-danger">🗑️ Vymazať všetky testy</button>
            </div>

            <button onclick="backToList()" class="btn-secondary">← Späť na zoznam testov</button>
        </div>

        <!-- AI Import -->
        <div id="aiImportPage" style="display: none;">
            <h2>🤖 AI Import otázok</h2>
            <p class="ai-import-subtitle">Nahrajte fotografiu otázok a AI ich automaticky rozpozná</p>

            <!-- Step 1: Upload fotky -->
            <div id="aiStep1" class="ai-step">
                <div class="ai-section">
                    <h3>1. Nahrajte fotografiu otázok</h3>
                    <p class="ai-import-subtitle" style="font-size: 0.9em; color: #666;">💡 Môžete nahrať aj viac fotiek naraz</p>
                    <input type="file" id="aiImageInput" accept="image/*" multiple onchange="previewImages(this)">
                    <div id="imagePreview" style="display: none; margin-top: 20px;">
                        <div id="previewContainer" style="display: flex; gap: 10px; flex-wrap: wrap;"></div>
                    </div>

                    <div style="margin-top: 15px; padding: 10px; background: #f0f8ff; border-radius: 8px; border-left: 4px solid #2196F3;">
                        <label style="display: flex; align-items: center; gap: 10px; cursor: pointer;">
                            <input type="checkbox" id="advancedPreprocessing" style="width: 18px; height: 18px; cursor: pointer;">
                            <div>
                                <strong style="color: #2196F3;">🔬 Pokročilé predspracovanie obrázka</strong>
                                <p style="margin: 5px 0 0 0; font-size: 0.85em; color: #666;">
                                    Použije CLAHE, denoising a adaptívny threshold pre lepšie rozpoznávanie (čiernobiele, vysoký kontrast)
                                </p>
                            </div>
                        </label>
                    </div>

                    <div style="display: flex; gap: 10px; margin-top: 15px;">
                        <button onclick="processImagesWithAI()" id="processBtn" class="btn-primary" style="display: none;">
                            ✨ Spracovať s AI
                        </button>
                        <button onclick="cancelAIImport()" class="btn-danger" style="display: none;" id="cancelStep1Btn">
                            ❌ Zrušiť
                        </button>
                    </div>
                </div>
            </div>

            <!-- Step 2: AI Processing -->
            <div id="aiStep2" class="ai-step" style="display: none;">
                <div class="ai-processing">
                    <div class="spinner"></div>
                    <p id="aiProcessingMessage">AI analyzuje obrázok...</p>
                    <p id="aiProcessingTime" class="ai-processing-detail" style="font-size: 0.9em; color: #666;"></p>
                    <button onclick="cancelAIImport()" class="btn-danger" style="margin-top: 20px;">
                        ❌ Zrušiť spracovanie
                    </button>
                </div>
            </div>

            <!-- Step 3: Náhľad a úprava otázok -->
            <div id="aiStep3" class="ai-step" style="display: none;">
                <div class="ai-section">
                    <h3>2. Skontrolujte a upravte otázky</h3>

                    <!-- Zobrazenie predspracovanej fotky -->
                    <div id="originalImagesContainer" style="margin: 20px 0; padding: 15px; background: #f5f5f5; border-radius: 8px;">
                        <h4 style="margin: 0 0 10px 0; color: #2196F3;">🔬 Predspracovaná fotka (čo AI videlo)</h4>
                        <div id="originalImagesPreview" style="max-height: 500px; overflow-y: auto;"></div>
                    </div>

                    <div id="aiQuestionsPreview" class="ai-questions-container"></div>

                    <div style="display: flex; gap: 10px; margin-top: 15px;">
                        <button onclick="addNewQuestion()" class="btn-secondary">➕ Pridať otázku</button>
                        <button onclick="cancelAIImport()" class="btn-danger">❌ Zrušiť import</button>
                    </div>
                </div>
            </div>

            <!-- Step 4: Uloženie -->
            <div id="aiStep4" class="ai-step" style="display: none;">
                <div class="ai-section">
                    <h3>3. Uložiť test</h3>

                    <div class="save-mode-selector">
                        <label>
                            <input type="radio" name="saveMode" value="new" checked onchange="updateSaveMode()">
                            Vytvoriť nový test
                        </label>
                        <label>
                            <input type="radio" name="saveMode" value="append" onchange="updateSaveMode()">
                            Pridať do existujúceho testu
                        </label>
                    </div>

                    <div id="newTestOptions" class="save-options">
                        <label>Názov testu:</label>
                        <input type="text" id="aiTestTitle" class="ai-input" placeholder="Napíšte názov testu">

                        <label>Popis testu:</label>
                        <input type="text" id="aiTestDesc" class="ai-input" placeholder="Voliteľný popis testu">

                        <label>Názov súboru (bez .json):</label>
                        <input type="text" id="newTestFileName" class="ai-input" placeholder="napr. Bio CAP 6">
                    </div>

                    <div id="appendTestOptions" class="save-options" style="display: none;">
                        <label>Vybrať existujúci test:</label>
                        <select id="existingTestSelect" class="ai-input"></select>
                    </div>

                    <div style="display: flex; gap: 10px; margin-top: 15px;">
                        <button onclick="saveAITest()" class="btn-success">💾 Uložiť test</button>
                        <button onclick="cancelAIImport()" class="btn-danger">❌ Zrušiť import</button>
                    </div>
                </div>
            </div>

            <button onclick="backToList()" class="btn-secondary">← Späť na zoznam testov</button>
        </div>

        <!-- Edit Test Page -->
        <div id="editTestPage" style="display: none;">
            <h2>✏️ Upraviť test</h2>

            <div class="ai-section">
                <h3>Základné údaje</h3>
                <div class="ai-suggestions">
                    <div class="suggestion-row">
                        <label>Názov testu:</label>
                        <input type="text" id="editTestTitle" class="ai-input" oninput="triggerAutosave()">
                    </div>
                    <div class="suggestion-row">
                        <label>Popis:</label>
                        <input type="text" id="editTestDesc" class="ai-input" oninput="triggerAutosave()">
                    </div>
                </div>

                <h3>Otázky</h3>
                <div id="editQuestionsContainer" class="ai-questions-container"></div>

                <button onclick="addEditQuestion()" class="btn-secondary">➕ Pridať otázku</button>
                <button onclick="saveEditedTest()" class="btn-success" style="margin-left: 10px;">💾 Uložiť zmeny</button>
            </div>

            <button onclick="backToList()" class="btn-secondary">← Späť na zoznam testov</button>
        </div>

        <!-- Príklad formátu -->
        <div id="examplePage" style="display: none;">
            <h2>📖 Príklad formátu testov</h2>

            <div class="example-section">
                <h3>Formát JSON súboru</h3>
                <p class="example-info">Vytvorte JSON súbor v priečinku <code>testy/</code> s nasledujúcim formátom:</p>

                <div class="example-code">
                    <h4>Jednoduchý príklad:</h4>
                    <pre><code>[
  {
    "title": "Názov testu",
    "description": "Popis testu",
    "questions": [
      {
        "question": "Otázka s jednou správnou odpoveďou?",
        "answers": [
          "Odpoveď 1",
          "Odpoveď 2",
          "Odpoveď 3",
          "Odpoveď 4"
        ],
        "correct": 0
      },
      {
        "question": "Otázka s viacerými správnymi odpoveďami?",
        "answers": [
          "Odpoveď A",
          "Odpoveď B",
          "Odpoveď C",
          "Odpoveď D"
        ],
        "correct": [0, 2]
      }
    ]
  }
]</code></pre>
                </div>

                <div class="example-notes">
                    <h4>Dôležité pravidlá:</h4>
                    <ul>
                        <li><strong>correct:</strong> Index správnej odpovede (0 = prvá, 1 = druhá, atď.)</li>
                        <li><strong>Jedna odpoveď:</strong> <code>"correct": 0</code> (číslo)</li>
                        <li><strong>Viac odpovedí:</strong> <code>"correct": [0, 2]</code> (pole čísel)</li>
                        <li><strong>title a description:</strong> Sú voliteľné</li>
                        <li><strong>Môžete mať:</strong> Jeden test <code>{ ... }</code> alebo viacero testov <code>[ {...}, {...} ]</code></li>
                    </ul>
                </div>

                <div class="example-file">
                    <h4>Ako vytvoriť súbor:</h4>
                    <pre><code>1. Vytvorte súbor: testy/moj_test.json
2. Skopírujte vyššie uvedený formát
3. Upravte otázky a odpovede
4. Obnovte stránku - test sa automaticky načíta</code></pre>
                </div>
            </div>

            <button onclick="backToImport()" class="btn-secondary">← Späť na import</button>
        </div>

        <!-- Nastavenia testu -->
        <div id="testSettings" style="display: none;">
            <h2 id="settingsTitle"></h2>

            <div class="settings-group">
                <h3>Časový limit</h3>
                <label>
                    <input type="radio" name="time" value="20" checked> 20 minút
                </label>
                <label>
                    <input type="radio" name="time" value="30"> 30 minút
                </label>
                <label>
                    <input type="radio" name="time" value="60"> 60 minút
                </label>
                <label>
                    <input type="radio" name="time" value="0"> Bez časového limitu
                </label>
            </div>

            <div class="settings-group">
                <h3>Rozsah otázok</h3>
                <label>Od otázky: <input type="number" id="questionFrom" value="1" min="1"></label>
                <label>Do otázky: <input type="number" id="questionTo" value="999" min="1"></label>
            </div>

            <div class="settings-group">
                <h3>Poradie otázok</h3>
                <label>
                    <input type="radio" name="shuffle" value="false" checked> Po poradí
                </label>
                <label>
                    <input type="radio" name="shuffle" value="true"> Zamixované
                </label>
            </div>

            <div class="settings-group">
                <h3>Zobrazenie správnych odpovedí</h3>
                <label>
                    <input type="radio" name="showAnswers" value="each" checked> Po každej otázke
                </label>
                <label>
                    <input type="radio" name="showAnswers" value="end"> Na konci testu
                </label>
                <label>
                    <input type="radio" name="showAnswers" value="retry"> Opakovať nesprávne otázky
                </label>
            </div>

            <button onclick="startTestWithSettings()">Spustiť test</button>
            <button onclick="showLearnMode()" class="btn-learn">Režim učenia</button>
            <button onclick="backToList()" class="btn-secondary">Zrušiť</button>
        </div>

        <!-- Test interface -->
        <div id="testInterface" style="display: none;">
            <div class="test-header">
                <h2 id="testTitle"></h2>
                <div id="timer" style="display: none;"></div>
            </div>
            <div id="questionContainer"></div>
            <div class="navigation">
                <button onclick="previousQuestion()" id="prevBtn">Predchádzajúca</button>
                <span id="questionNumber"></span>
                <button onclick="nextQuestion()" id="nextBtn">Ďalšia</button>
            </div>
            <button onclick="submitTest()" id="submitBtn" style="display: none;">Odovzdať test</button>
            <button onclick="backToList()" class="btn-secondary">Späť na zoznam</button>
        </div>

        <!-- Výsledky -->
        <div id="results" style="display: none;">
            <h2>Výsledky testu</h2>
            <div id="resultsContainer"></div>
            <button onclick="backToList()">Späť na zoznam</button>
        </div>

        <!-- Režim učenia -->
        <div id="learnMode" style="display: none;">
            <h2 id="learnModeTitle"></h2>
            <p class="learn-mode-info">Režim učenia - všetky otázky so správnymi odpoveďami</p>
            <div id="learnModeContainer"></div>
            <button onclick="backToList()">Späť na zoznam</button>
        </div>
    </div>

    <script src="{{ url_for('static', filename='app.js') }}?v=1.3.18"></script>
</body>
</html>
