<!DOCTYPE html>
<html lang="sk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Tester - Inteligentné testovanie</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
    <div class="container">
        <div class="app-header">
            <h1 onclick="backToList()" style="cursor: pointer;" title="Späť na hlavnú stránku">AI Tester</h1>
            <span class="version-badge" onclick="showVersionInfo()" style="cursor: pointer;" title="Kliknite pre info">v1.0.3</span>
        </div>

        <!-- Zoznam testov -->
        <div class="section">
            <div class="test-header-controls">
                <h2>Dostupné testy</h2>
                <div>
                    <button onclick="showHelpPage()" class="btn-info btn-small">📖 Návod</button>
                    <button onclick="showImportPage()" class="btn-import btn-small">📁 Import testov</button>
                    <button onclick="showAIImportPage()" class="btn-ai-import btn-small">🤖 AI Import</button>
                    <button onclick="startMultipleTests()" class="btn-multi" id="startMultiBtn" style="display: none;">
                        Spustiť vybrané testy
                    </button>
                    <button onclick="clearStatistics()" class="btn-danger btn-small">Vymazať štatistiky</button>
                </div>
            </div>
            <div id="testList"></div>
        </div>

        <!-- Verzia Info -->
        <div id="versionPage" style="display: none;">
            <h2>ℹ️ AI Tester v1.0.3</h2>

            <div class="help-section">
                <h3>🎯 Hlavné funkcie</h3>
                <ul>
                    <li><strong>🤖 AI Import otázok z fotky</strong> - Odfotiť otázky a AI ich automaticky rozpozná</li>
                    <li><strong>✏️ Editor testov</strong> - Úprava existujúcich testov priamo v aplikácii</li>
                    <li><strong>✅ Viacero správnych odpovedí</strong> - Podpora otázok s viacerými správnymi odpoveďami</li>
                    <li><strong>📊 Štatistiky</strong> - Sledovanie výsledkov, priemernej úspešnosti</li>
                    <li><strong>⏱️ Časový limit</strong> - 20/30/60 minút alebo bez limitu</li>
                    <li><strong>🎲 Mixovanie otázok</strong> - Náhodné poradie pre lepšiu prax</li>
                    <li><strong>📚 Režim učenia</strong> - Prezeranie všetkých otázok so správnymi odpoveďami</li>
                    <li><strong>🔄 Zlučovanie testov</strong> - Možnosť absolvovať viac testov naraz</li>
                </ul>
            </div>

            <div class="help-section">
                <h3>🆕 Novinky v1.0.3</h3>
                <ul>
                    <li>✨ <strong>Predspracovanie obrázkov</strong> - Automatické zlepšenie ostrosti a kontrastu pre lepšie rozpoznávanie</li>
                    <li>🎯 <strong>Vylepšené rozpoznávanie</strong> - AI presnejšie rozpozná viacero správnych odpovedí z fotky</li>
                    <li>☑️ <strong>Checkbox interface</strong> - Pri otázkach s viacerými správnymi sa zobrazí varovanie</li>
                    <li>🔧 <strong>Backward kompatibilita</strong> - Staré testy fungujú bez úprav</li>
                </ul>
            </div>

            <div class="help-section">
                <h3>🤖 AI Import - Ako to funguje?</h3>
                <ol>
                    <li>Odfotiť alebo nahrať fotku s otázkami</li>
                    <li>Obrázok sa automaticky predspracuje (ostrosť, kontrast, jas)</li>
                    <li>AI (GPT-4o) analyzuje obrázok a rozpozná:
                        <ul>
                            <li>Text otázok a odpovedí</li>
                            <li>Zakrúžkované odpovede</li>
                            <li>Podčiarknutý, tučný alebo zvýraznený text</li>
                            <li>Checkmarky a hviezdičky</li>
                        </ul>
                    </li>
                    <li>Skontrolujete a upravíte výsledok</li>
                    <li>Uložíte ako nový test alebo pridáte k existujúcemu</li>
                </ol>
            </div>

            <div class="help-section">
                <h3>💡 Tipy na lepšie výsledky</h3>
                <ul>
                    <li>Urobte ostrú fotografiu s dobrým osvetlením</li>
                    <li>Správne odpovede jasne zakrúžkujte alebo podčiarknite</li>
                    <li>Text by mal byť čitateľný a nezmazaný</li>
                    <li>Vyhnite sa tieňom a odleskom</li>
                </ul>
            </div>

            <button onclick="backToList()" class="btn-secondary">← Späť na zoznam testov</button>
        </div>

        <!-- Návod -->
        <div id="helpPage" style="display: none;">
            <h2>📖 Návod na použitie</h2>

            <div class="help-section">
                <h3>Načítanie testov</h3>
                <p><strong>Spôsob 1: Automatické načítanie (odporúčané)</strong></p>
                <ol>
                    <li>Vložte JSON súbory s testami do priečinka <code>testy/</code></li>
                    <li>V aplikácii kliknite na "📁 Import testov"</li>
                    <li>Kliknite na "📂 Automaticky načítať všetky testy"</li>
                </ol>

                <p><strong>Spôsob 2: Manuálne nahratie</strong></p>
                <ol>
                    <li>Kliknite na "📁 Import testov"</li>
                    <li>Vyberte JSON súbor z vášho počítača</li>
                    <li>Kliknite na "📤 Nahrať súbor"</li>
                </ol>
            </div>

            <div class="help-section">
                <h3>Absolvovanie testu</h3>
                <ol>
                    <li>Vyberte test zo zoznamu (zobrazí sa dialóg s nastaveniami)</li>
                    <li>Nastavte parametre:
                        <ul>
                            <li><strong>Časový limit:</strong> 20/30/60 minút alebo bez limitu</li>
                            <li><strong>Rozsah otázok:</strong> Vyberte od-do ktorej otázky chcete absolvovať</li>
                            <li><strong>Poradie:</strong> Po poradí alebo zamixované</li>
                            <li><strong>Zobrazenie odpovedí:</strong> Nezobrazovať / Po každej otázke / Na konci testu</li>
                        </ul>
                    </li>
                    <li>Kliknite na "Spustiť test" alebo "Režim učenia"</li>
                    <li>Absolvujte test a pozrite si výsledky</li>
                </ol>
            </div>

            <div class="help-section">
                <h3>Ďalšie funkcie</h3>
                <ul>
                    <li><strong>Viacero testov naraz:</strong> Zaškrtnite checkboxy pri testoch a kliknite "Spustiť vybrané testy"</li>
                    <li><strong>Štatistiky:</strong> Pri každom teste sa zobrazujú (počet absolvovaní, posledný výsledok, priemer)</li>
                    <li><strong>Režim učenia:</strong> Zobrazí celý test so správnymi odpoveďami - vhodné na učenie</li>
                    <li><strong>Zobrazenie po každej otázke:</strong> Ihneď po odpovedi uvidíte správne/nesprávne odpovede</li>
                    <li><strong>Zobrazenie na konci:</strong> Po skončení testu uvidíte všetky správne odpovede</li>
                </ul>
            </div>

            <div class="help-section">
                <h3>Formát JSON súboru</h3>
                <p>Pre vytvorenie vlastných testov použite tento formát:</p>
                <pre><code>[
  {
    "title": "Názov testu",
    "description": "Popis testu",
    "questions": [
      {
        "question": "Otázka s jednou správnou odpoveďou?",
        "answers": ["Odpoveď 1", "Odpoveď 2", "Odpoveď 3"],
        "correct": 0
      },
      {
        "question": "Otázka s viacerými správnymi odpoveďami?",
        "answers": ["Odpoveď A", "Odpoveď B", "Odpoveď C"],
        "correct": [0, 2]
      }
    ]
  }
]</code></pre>
                <p><strong>Pravidlá:</strong></p>
                <ul>
                    <li><code>correct</code> môže byť jedno číslo (jedna správna) alebo pole čísel (viac správnych)</li>
                    <li>Index začína od 0 (0 = prvá odpoveď, 1 = druhá, atď.)</li>
                    <li>Pri viacerých správnych musíte vybrať všetky</li>
                </ul>
            </div>

            <button onclick="backToList()" class="btn-secondary">← Späť na zoznam testov</button>
        </div>

        <!-- Import testov -->
        <div id="importPage" style="display: none;">
            <h2>Import testov</h2>

            <div class="import-section">
                <h3>Automatické načítanie z priečinka <code>testy/</code></h3>
                <p class="import-info">Načíta všetky JSON súbory z priečinka <code>testy/</code> v projektovom priečinku</p>
                <div id="filesList" class="files-list"></div>
                <button onclick="loadFromFolder()" class="btn-auto">📂 Automaticky načítať všetky testy</button>
                <button onclick="showExample()" class="btn-info">📖 Zobraziť príklad formátu</button>
            </div>

            <div class="import-divider">ALEBO</div>

            <div class="import-section">
                <h3>Manuálne nahranie súboru</h3>
                <p class="import-info">Vyberte JSON súbor z vášho počítača</p>
                <input type="file" id="fileInput" accept=".json">
                <button onclick="importTests()">📤 Nahrať súbor</button>
            </div>

            <div class="import-section danger-section">
                <h3>Vymazať testy</h3>
                <button onclick="clearTests()" class="btn-danger">🗑️ Vymazať všetky testy</button>
            </div>

            <button onclick="backToList()" class="btn-secondary">← Späť na zoznam testov</button>
        </div>

        <!-- AI Import -->
        <div id="aiImportPage" style="display: none;">
            <h2>🤖 AI Import otázok</h2>
            <p class="ai-import-subtitle">Nahrajte fotografiu otázok a AI ich automaticky rozpozná</p>

            <!-- Step 1: Upload fotky -->
            <div id="aiStep1" class="ai-step">
                <div class="ai-section">
                    <h3>1. Nahrajte fotografiu otázok</h3>
                    <p class="ai-import-subtitle" style="font-size: 0.9em; color: #666;">💡 Môžete nahrať aj viac fotiek naraz</p>
                    <input type="file" id="aiImageInput" accept="image/*" multiple onchange="previewImages(this)">
                    <div id="imagePreview" style="display: none; margin-top: 20px;">
                        <div id="previewContainer" style="display: flex; gap: 10px; flex-wrap: wrap;"></div>
                    </div>

                    <div style="margin-top: 15px; padding: 10px; background: #f0f8ff; border-radius: 8px; border-left: 4px solid #2196F3;">
                        <label style="display: flex; align-items: center; gap: 10px; cursor: pointer;">
                            <input type="checkbox" id="advancedPreprocessing" style="width: 18px; height: 18px; cursor: pointer;">
                            <div>
                                <strong style="color: #2196F3;">🔬 Pokročilé predspracovanie obrázka</strong>
                                <p style="margin: 5px 0 0 0; font-size: 0.85em; color: #666;">
                                    Použije CLAHE, denoising a adaptívny threshold pre lepšie rozpoznávanie (čiernobiele, vysoký kontrast)
                                </p>
                            </div>
                        </label>
                    </div>

                    <button onclick="processImagesWithAI()" id="processBtn" class="btn-primary" style="display: none; margin-top: 15px;">
                        ✨ Spracovať s AI
                    </button>
                </div>
            </div>

            <!-- Step 2: AI Processing -->
            <div id="aiStep2" class="ai-step" style="display: none;">
                <div class="ai-processing">
                    <div class="spinner"></div>
                    <p>AI analyzuje obrázok...</p>
                    <p class="ai-processing-detail">Toto môže trvať 10-30 sekúnd</p>
                </div>
            </div>

            <!-- Step 3: Náhľad a úprava otázok -->
            <div id="aiStep3" class="ai-step" style="display: none;">
                <div class="ai-section">
                    <h3>2. Skontrolujte a upravte otázky</h3>
                    <div class="ai-suggestions">
                        <div class="suggestion-row">
                            <label>Navrhnutý názov testu:</label>
                            <input type="text" id="aiSuggestedTitle" class="ai-input">
                        </div>
                        <div class="suggestion-row">
                            <label>Popis:</label>
                            <input type="text" id="aiSuggestedDesc" class="ai-input">
                        </div>
                    </div>

                    <!-- Zobrazenie pôvodných fotiek -->
                    <div id="originalImagesContainer" style="margin: 20px 0; padding: 15px; background: #f5f5f5; border-radius: 8px;">
                        <h4 style="margin: 0 0 10px 0;">📷 Pôvodné fotky (pre porovnanie)</h4>
                        <div id="originalImagesPreview" style="display: flex; gap: 10px; flex-wrap: wrap; max-height: 400px; overflow-y: auto;"></div>
                    </div>

                    <div id="aiQuestionsPreview" class="ai-questions-container"></div>

                    <button onclick="addNewQuestion()" class="btn-secondary">➕ Pridať otázku</button>
                </div>
            </div>

            <!-- Step 4: Uloženie -->
            <div id="aiStep4" class="ai-step" style="display: none;">
                <div class="ai-section">
                    <h3>3. Uložiť test</h3>

                    <div class="save-mode-selector">
                        <label>
                            <input type="radio" name="saveMode" value="new" checked onchange="updateSaveMode()">
                            Vytvoriť nový test
                        </label>
                        <label>
                            <input type="radio" name="saveMode" value="append" onchange="updateSaveMode()">
                            Pridať do existujúceho testu
                        </label>
                    </div>

                    <div id="newTestOptions" class="save-options">
                        <label>Názov súboru (bez .json):</label>
                        <input type="text" id="newTestFileName" class="ai-input" placeholder="napr. Bio CAP 6">
                    </div>

                    <div id="appendTestOptions" class="save-options" style="display: none;">
                        <label>Vybrať existujúci test:</label>
                        <select id="existingTestSelect" class="ai-input"></select>
                    </div>

                    <button onclick="saveAITest()" class="btn-success">💾 Uložiť test</button>
                </div>
            </div>

            <button onclick="backToList()" class="btn-secondary">← Späť na zoznam testov</button>
        </div>

        <!-- Edit Test Page -->
        <div id="editTestPage" style="display: none;">
            <h2>✏️ Upraviť test</h2>

            <div class="ai-section">
                <h3>Základné údaje</h3>
                <div class="ai-suggestions">
                    <div class="suggestion-row">
                        <label>Názov testu:</label>
                        <input type="text" id="editTestTitle" class="ai-input">
                    </div>
                    <div class="suggestion-row">
                        <label>Popis:</label>
                        <input type="text" id="editTestDesc" class="ai-input">
                    </div>
                </div>

                <h3>Otázky</h3>
                <div id="editQuestionsContainer" class="ai-questions-container"></div>

                <button onclick="addEditQuestion()" class="btn-secondary">➕ Pridať otázku</button>
                <button onclick="saveEditedTest()" class="btn-success" style="margin-left: 10px;">💾 Uložiť zmeny</button>
            </div>

            <button onclick="backToList()" class="btn-secondary">← Späť na zoznam testov</button>
        </div>

        <!-- Príklad formátu -->
        <div id="examplePage" style="display: none;">
            <h2>📖 Príklad formátu testov</h2>

            <div class="example-section">
                <h3>Formát JSON súboru</h3>
                <p class="example-info">Vytvorte JSON súbor v priečinku <code>testy/</code> s nasledujúcim formátom:</p>

                <div class="example-code">
                    <h4>Jednoduchý príklad:</h4>
                    <pre><code>[
  {
    "title": "Názov testu",
    "description": "Popis testu",
    "questions": [
      {
        "question": "Otázka s jednou správnou odpoveďou?",
        "answers": [
          "Odpoveď 1",
          "Odpoveď 2",
          "Odpoveď 3",
          "Odpoveď 4"
        ],
        "correct": 0
      },
      {
        "question": "Otázka s viacerými správnymi odpoveďami?",
        "answers": [
          "Odpoveď A",
          "Odpoveď B",
          "Odpoveď C",
          "Odpoveď D"
        ],
        "correct": [0, 2]
      }
    ]
  }
]</code></pre>
                </div>

                <div class="example-notes">
                    <h4>Dôležité pravidlá:</h4>
                    <ul>
                        <li><strong>correct:</strong> Index správnej odpovede (0 = prvá, 1 = druhá, atď.)</li>
                        <li><strong>Jedna odpoveď:</strong> <code>"correct": 0</code> (číslo)</li>
                        <li><strong>Viac odpovedí:</strong> <code>"correct": [0, 2]</code> (pole čísel)</li>
                        <li><strong>title a description:</strong> Sú voliteľné</li>
                        <li><strong>Môžete mať:</strong> Jeden test <code>{ ... }</code> alebo viacero testov <code>[ {...}, {...} ]</code></li>
                    </ul>
                </div>

                <div class="example-file">
                    <h4>Ako vytvoriť súbor:</h4>
                    <pre><code>1. Vytvorte súbor: testy/moj_test.json
2. Skopírujte vyššie uvedený formát
3. Upravte otázky a odpovede
4. Kliknite "Automaticky načítať" v aplikácii</code></pre>
                </div>
            </div>

            <button onclick="backToImport()" class="btn-secondary">← Späť na import</button>
        </div>

        <!-- Nastavenia testu -->
        <div id="testSettings" style="display: none;">
            <h2 id="settingsTitle"></h2>

            <div class="settings-group">
                <h3>Časový limit</h3>
                <label>
                    <input type="radio" name="time" value="20" checked> 20 minút
                </label>
                <label>
                    <input type="radio" name="time" value="30"> 30 minút
                </label>
                <label>
                    <input type="radio" name="time" value="60"> 60 minút
                </label>
                <label>
                    <input type="radio" name="time" value="0"> Bez časového limitu
                </label>
            </div>

            <div class="settings-group">
                <h3>Rozsah otázok</h3>
                <label>Od otázky: <input type="number" id="questionFrom" value="1" min="1"></label>
                <label>Do otázky: <input type="number" id="questionTo" value="999" min="1"></label>
            </div>

            <div class="settings-group">
                <h3>Poradie otázok</h3>
                <label>
                    <input type="radio" name="shuffle" value="false" checked> Po poradí
                </label>
                <label>
                    <input type="radio" name="shuffle" value="true"> Zamixované
                </label>
            </div>

            <div class="settings-group">
                <h3>Zobrazenie správnych odpovedí</h3>
                <label>
                    <input type="radio" name="showAnswers" value="none" checked> Nezobrazovať
                </label>
                <label>
                    <input type="radio" name="showAnswers" value="each"> Po každej otázke
                </label>
                <label>
                    <input type="radio" name="showAnswers" value="end"> Na konci testu
                </label>
            </div>

            <button onclick="startTestWithSettings()">Spustiť test</button>
            <button onclick="showLearnMode()" class="btn-learn">Režim učenia</button>
            <button onclick="backToList()" class="btn-secondary">Zrušiť</button>
        </div>

        <!-- Test interface -->
        <div id="testInterface" style="display: none;">
            <div class="test-header">
                <h2 id="testTitle"></h2>
                <div id="timer" style="display: none;"></div>
            </div>
            <div id="questionContainer"></div>
            <div class="navigation">
                <button onclick="previousQuestion()" id="prevBtn">Predchádzajúca</button>
                <span id="questionNumber"></span>
                <button onclick="nextQuestion()" id="nextBtn">Ďalšia</button>
            </div>
            <button onclick="submitTest()" id="submitBtn" style="display: none;">Odovzdať test</button>
            <button onclick="backToList()" class="btn-secondary">Späť na zoznam</button>
        </div>

        <!-- Výsledky -->
        <div id="results" style="display: none;">
            <h2>Výsledky testu</h2>
            <div id="resultsContainer"></div>
            <button onclick="backToList()">Späť na zoznam</button>
        </div>

        <!-- Režim učenia -->
        <div id="learnMode" style="display: none;">
            <h2 id="learnModeTitle"></h2>
            <p class="learn-mode-info">Režim učenia - všetky otázky so správnymi odpoveďami</p>
            <div id="learnModeContainer"></div>
            <button onclick="backToList()">Späť na zoznam</button>
        </div>
    </div>

    <script src="{{ url_for('static', filename='app.js') }}"></script>
</body>
</html>
